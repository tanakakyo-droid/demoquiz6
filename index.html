
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>英検準一級単語 No.1～No.60</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
      background: linear-gradient(to bottom, #ccff99, #ffffff);
    }
    header {
      background: #ccff66;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #title {
      flex-grow: 1;
      text-align: center;
      font-size: 28px;
      font-weight: bold;
      color: #333;
    }
    .quiz-container {
      max-width: 800px;
      min-height: 600px;
      margin: 20px auto;
      padding: 20px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .input-field {
      margin: 10px;
      padding: 10px;
      font-size: 22px;
      width: 200px;
    }
    .button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
      border: none;
      border-radius: 8px;
      background: #007BFF;
      color: white;
    }
    .circle-button {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: none;
      margin-left: 8px;
      cursor: pointer;
      background-color: #007BFF;
      color: white;
      font-size: 14px;
    }
    .progress-bar { width: 100%; background: #ddd; border-radius: 10px; margin-top: 20px; }
    .progress { height: 20px; background: #4CAF50; border-radius: 10px; width: 0%; }
    .hidden { display: none; }
    #question { font-size: 24px; margin-bottom: 20px; }
    #translation { font-size: 20px; margin-top: 15px; }
  </style>
</head>
<body>
  <header>
    <label id="nameLabel">名前: <input type="text" id="username" placeholder="Your name"></label>
    <div id="title">英検準一級単語 No.1～No.60</div>
    <div>
      <button class="button hidden" id="retryBtn">Retry Incorrect Questions</button>
      <button class="button hidden" id="pdfBtn">Download PDF</button>
      <button class="button hidden" id="wrongPdfBtn">Download Wrong-vocab</button>
    </div>
  </header>

  <div class="quiz-container">
    <div id="question"></div>
    <div id="inputs"></div>
    <button class="button" id="submitBtn">Submit</button>
    <button class="button hidden" id="nextBtn">Next</button>
    <button class="button hidden" id="showAllBtn">Show All Results</button>
    <div id="feedback"></div>
    <div id="translation"></div>
    <div class="progress-bar" id="progressBar"><div class="progress" id="progress"></div></div>
    <div id="scoreBoard"></div>
  </div>

  <script>
   // === 問題データ ===
   const questions = [
 {
  "sentence": "Patients are ___ to infection just after surgery.",
  "answers": ["vulnerable"],
  "translation": "Patients are vulnerable to infection just after surgery.",
  "jpTranslation": "患者は手術の直後、感染症にかかりやすくなる。",
  "blanksTranslation": ["かかりやすい"]
 },
 {
  "sentence": "Make sure to ___ all the warning signs.",
  "answers": ["heed"],
  "translation": "Make sure to heed all the warning signs.",
  "jpTranslation": "すべての警戒標識に気をつけるようにしてください。",
  "blanksTranslation": ["気をつける"]
 },
 {
  "sentence": "A ___ captured the arrest on video.",
  "answers": ["bystander"],
  "translation": "A bystander captured the arrest on video.",
  "jpTranslation": "その場に居合わせた人が逮捕の様子を動画に収めた。",
  "blanksTranslation": ["傍観者"]
 },
 {
  "sentence": "The bridge eases ___ in the area.",
  "answers": ["congestion"],
  "translation": "The bridge eases congestion in the area.",
  "jpTranslation": "その橋は地域の混雑を緩和している。",
  "blanksTranslation": ["混雑"]
 },
 {
  "sentence": "She ___ all her appliances and replaced them with new ones.",
  "answers": ["discarded"],
  "translation": "She discarded all her appliances and replaced them with new ones.",
  "jpTranslation": "彼女はすべての電化製品を捨て、新しいものに買い換えた。",
  "blanksTranslation": ["〜を捨てる"]
 },
 {
  "sentence": "The ___ was completely out of control and spread quickly.",
  "answers": ["blaze"],
  "translation": "The blaze was completely out of control and spread quickly.",
  "jpTranslation": "炎は完全に制御不能で、あっという間に燃え広がった。",
  "blanksTranslation": ["炎"]
 },
 {
  "sentence": "He is a little ___ with a paintbrush.",
  "answers": ["clumsy"],
  "translation": "He is a little clumsy with a paintbrush.",
  "jpTranslation": "彼は絵筆を使うのが少し不器用だ。",
  "blanksTranslation": ["不器用な"]
 },
 {
  "sentence": "We must ___ major sources of pollution quickly.",
  "answers": ["eliminate"],
  "translation": "We must eliminate major sources of pollution quickly.",
  "jpTranslation": "私たちは主要な汚染源を早急に除去しなければならない。",
  "blanksTranslation": ["〜を取り除く"]
 },
 {
  "sentence": "The politician ___ his involvement in the scandal.",
  "answers": ["acknowledged"],
  "translation": "The politician acknowledged his involvement in the scandal.",
  "jpTranslation": "その政治家はスキャンダルへの関与を認めた。",
  "blanksTranslation": ["〜を認める"]
 },
 {
  "sentence": "Not all mushrooms are ___, so you have to be careful.",
  "answers": ["edible"],
  "translation": "Not all mushrooms are edible, so you have to be careful.",
  "jpTranslation": "すべてのキノコが食べられるわけではないので、注意が必要だ。",
  "blanksTranslation": ["食べられる"]
 },
 {
  "sentence": "Our people have ___ the land here for centuries.",
  "answers": ["cultivated"],
  "translation": "Our people have cultivated the land here for centuries.",
  "jpTranslation": "私たち一族は何世紀にもわたってこの土地を耕してきた。",
  "blanksTranslation": ["(土地)を耕す"]
 },
 {
  "sentence": "She had to pay a fine because her payment was ___.",
  "answers": ["overdue"],
  "translation": "She had to pay a fine because her payment was overdue.",
  "jpTranslation": "支払いの期間が過ぎてしまったため、彼女は罰金を支払わなければならなかった。",
  "blanksTranslation": ["期限が過ぎて"]
 },
 {
  "sentence": "The university's ___ increases almost every year.",
  "answers": ["enrollment"],
  "translation": "The university's enrollment increases almost every year.",
  "jpTranslation": "その大学の登録者数はほとんど毎年増えている。",
  "blanksTranslation": ["登録"]
 },
 {
  "sentence": "He ___ the help of friends when setting up his business.",
  "answers": ["enlisted"],
  "translation": "He enlisted the help of friends when setting up his business.",
  "jpTranslation": "彼は会社を立ち上げるときに友人の援助を得た。",
  "blanksTranslation": ["(援助など)を得る"]
 },
 {
  "sentence": "___ reigned in the country during the civil war.",
  "answers": ["Anarchy"],
  "translation": "Anarchy reigned in the country during the civil war.",
  "jpTranslation": "内戦中、国は無政府状態になった。",
  "blanksTranslation": ["無政府状態"]
 },
 {
  "sentence": "She was ___ to give an answer.",
  "answers": ["reluctant"],
  "translation": "She was reluctant to give an answer.",
  "jpTranslation": "彼女は返事をしたがらなかった。",
  "blanksTranslation": ["気乗りがしない"]
 },
 {
  "sentence": "Our company does not offer a service to ship ___ items.",
  "answers": ["fragile"],
  "translation": "Our company does not offer a service to ship fragile items.",
  "jpTranslation": "当社では、壊れやすいものの配送サービスは行っておりません。",
  "blanksTranslation": ["壊れやすい"]
 },
 {
  "sentence": "Your work performance will be ___ twice per year.",
  "answers": ["evaluated"],
  "translation": "Your work performance will be evaluated twice per year.",
  "jpTranslation": "業績は、年に2回評価されます。",
  "blanksTranslation": ["〜を評価する"]
 },
 {
  "sentence": "We will ___ the class at 3:00 p.m.",
  "answers": ["resume"],
  "translation": "We will resume the class at 3:00 p.m.",
  "jpTranslation": "午後3時に授業を再開します。",
  "blanksTranslation": ["〜を再開する"]
 },
 {
  "sentence": "She was ___ after a day of walking in the city.",
  "answers": ["weary"],
  "translation": "She was weary after a day of walking in the city.",
  "jpTranslation": "彼女は一日中街を歩いて疲れきっていた。",
  "blanksTranslation": ["ひどく疲れた"]
 },
 {
  "sentence": "Her grandparents took ___ of her after the accident.",
  "answers": ["custody"],
  "translation": "Her grandparents took custody of her after the accident.",
  "jpTranslation": "事故のあと、祖父母が彼女を保護した。",
  "blanksTranslation": ["保護"]
 },
 {
  "sentence": "The two parties formed a ___ government.",
  "answers": ["coalition"],
  "translation": "The two parties formed a coalition government.",
  "jpTranslation": "その2つの政党は連立政権を樹立した。",
  "blanksTranslation": ["連立"]
 },
 {
  "sentence": "That area has many large, ___ forests.",
  "answers": ["tranquil"],
  "translation": "That area has many large, tranquil forests.",
  "jpTranslation": "その地域には、大きくて静かな森がたくさんある。",
  "blanksTranslation": ["静かな"]
 },
 {
  "sentence": "It is the job of the police to ___ the law.",
  "answers": ["enforce"],
  "translation": "It is the job of the police to enforce the law.",
  "jpTranslation": "法律を遵守させるのは警察の仕事だ。",
  "blanksTranslation": ["(法律など)を守らせる"]
 },
 {
  "sentence": "The woman ___ herself as a man to avoid police.",
  "answers": ["disguised"],
  "translation": "The woman disguised herself as a man to avoid police.",
  "jpTranslation": "その女性は警察の目を避けるために男性に変装した。",
  "blanksTranslation": ["〜を変装させる"]
 },
 {
  "sentence": "The school plans to use the ___ of funds to update the gymnasium.",
  "answers": ["surplus"],
  "translation": "The school plans to use the surplus of funds to update the gymnasium.",
  "jpTranslation": "その学校は、余剰金を使って体育館を改修する予定だ。",
  "blanksTranslation": ["余剰"]
 },
 {
  "sentence": "The activists are looking for more people to sign their ___.",
  "answers": ["petition"],
  "translation": "The activists are looking for more people to sign their petition.",
  "jpTranslation": "活動家たちは嘆願書に署名してくれるさらに多くの人を探している。",
  "blanksTranslation": ["嘆願書"]
 },
 {
  "sentence": "He is a ___ late sleeper and is often late to work.",
  "answers": ["habitual"],
  "translation": "He is a habitual late sleeper and is often late to work.",
  "jpTranslation": "彼は寝坊の常習犯で、よく仕事に遅刻する。",
  "blanksTranslation": ["常習的な"]
 },
 {
  "sentence": "The building is new, so there are still several ___ apartments.",
  "answers": ["vacant"],
  "translation": "The building is new, so there are still several vacant apartments.",
  "jpTranslation": "そのビルは新しいので、まだいくつか空き部屋がある。",
  "blanksTranslation": ["空いている"]
 },
 {
  "sentence": "Critics have praised the author's ___ use of poetic language.",
  "answers": ["daring"],
  "translation": "Critics have praised the author's daring use of poetic language.",
  "jpTranslation": "批評家たちは、その著者の大胆な詩的言葉遣いを称賛している。",
  "blanksTranslation": ["大胆な"]
 },
 {
  "sentence": "The company's business activities are ___ in Southeast Asia.",
  "answers": ["thriving"],
  "translation": "The company's business activities are thriving in Southeast Asia.",
  "jpTranslation": "その会社の事業活動は東南アジアで成功している。",
  "blanksTranslation": ["繁栄する"]
 },
 {
  "sentence": "She has a large purse divided into several ___.",
  "answers": ["compartments"],
  "translation": "She has a large purse divided into several compartments.",
  "jpTranslation": "彼女はいくつかの仕切りに分かれた大きなハンドバッグを持っている。",
  "blanksTranslation": ["仕切られた部分"]
 },
 {
  "sentence": "The growth of the economy continues to ___ rapidly.",
  "answers": ["accelerate"],
  "translation": "The growth of the economy continues to accelerate rapidly.",
  "jpTranslation": "経済成長は急速に加速し続けている。",
  "blanksTranslation": ["加速する"]
 },
 {
  "sentence": "Most people in this neighborhood are ___ of Japanese immigrants.",
  "answers": ["descendants"],
  "translation": "Most people in this neighborhood are descendants of Japanese immigrants.",
  "jpTranslation": "この界隈のほとんどの人は日本からの移民の子孫だ。",
  "blanksTranslation": ["子孫"]
 },
 {
  "sentence": "The old barn ___ until there was nothing left.",
  "answers": ["decayed"],
  "translation": "The old barn decayed until there was nothing left.",
  "jpTranslation": "古い納屋は朽ち果てて、最後には何も残らなかった。",
  "blanksTranslation": ["腐る"]
 },
 {
  "sentence": "Our smartphone designs are constantly being ___ and improved.",
  "answers": ["refined"],
  "translation": "Our smartphone designs are constantly being refined and improved.",
  "jpTranslation": "当社のスマートフォンのデザインは、絶えず洗練と改良を続けております。",
  "blanksTranslation": ["〜を洗練する"]
 },
 {
  "sentence": "The bug bites on her legs ___ and turned red.",
  "answers": ["swelled"],
  "translation": "The bug bites on her legs swelled and turned red.",
  "jpTranslation": "彼女の両脚の虫刺されは、腫れて赤くなった。",
  "blanksTranslation": ["腫れる"]
 },
 {
  "sentence": "A large ___ of the population does not have access to clean water.",
  "answers": ["segment"],
  "translation": "A large segment of the population does not have access to clean water.",
  "jpTranslation": "人口の大部分はきれいな水を手に入れることができない。",
  "blanksTranslation": ["部分"]
 },
 {
  "sentence": "Several politicians have been arrested for taking ___.",
  "answers": ["bribes"],
  "translation": "Several politicians have been arrested for taking bribes.",
  "jpTranslation": "賄賂を受け取ったとして何人かの政治家が逮捕された。",
  "blanksTranslation": ["賄賂"]
 },
 {
  "sentence": "She has been ___ with comic books since she was young.",
  "answers": ["obsessed"],
  "translation": "She has been obsessed with comic books since she was young.",
  "jpTranslation": "彼女は幼いころからずっと漫画に夢中だ。",
  "blanksTranslation": ["心を奪われた"]
 },
 {
  "sentence": "The CEO ___ his promise to avoid company-wide layoffs.",
  "answers": ["upheld"],
  "translation": "The CEO upheld his promise to avoid company-wide layoffs.",
  "jpTranslation": "CEOは、全社的な解雇を回避するという約束を守った。",
  "blanksTranslation": ["(公約など)を守る"]
 },
 {
  "sentence": "The organization is trying to ___ the government.",
  "answers": ["overthrow"],
  "translation": "The organization is trying to overthrow the government.",
  "jpTranslation": "その組織は政府を転覆させようとしている。",
  "blanksTranslation": ["(政府など)を転覆させる"]
 },
 {
  "sentence": "He let his wife decide the ___ for their trip to Europe.",
  "answers": ["itinerary"],
  "translation": "He let his wife decide the itinerary for their trip to Europe.",
  "jpTranslation": "彼はヨーロッパ旅行の計画を妻に任せた。",
  "blanksTranslation": ["旅程(表)"]
 },
 {
  "sentence": "We heard a ___ noise coming from the basement.",
  "answers": ["faint"],
  "translation": "We heard a faint noise coming from the basement.",
  "jpTranslation": "地下室からかすかな物音が聞こえた。",
  "blanksTranslation": ["かすかな"]
 },
 {
  "sentence": "She left ___ instructions regarding how to take care of her dogs.",
  "answers": ["explicit"],
  "translation": "She left explicit instructions regarding how to take care of her dogs.",
  "jpTranslation": "彼女は犬たちの世話の仕方について明確な指示を残した。",
  "blanksTranslation": ["明白な"]
 },
 {
  "sentence": "His grandmother was always ___ when he was a child.",
  "answers": ["lenient"],
  "translation": "His grandmother was always lenient when he was a child.",
  "jpTranslation": "彼が子どものころ、彼の祖母はいつも甘かった。",
  "blanksTranslation": ["寛大な"]
 },
 {
  "sentence": "Have you ever ___ quitting and finding a new job?",
  "answers": ["contemplated"],
  "translation": "Have you ever contemplated quitting and finding a new job?",
  "jpTranslation": "仕事を辞めて新しい仕事を探すことを考えたことはありますか。",
  "blanksTranslation": ["〜を熟考する"]
 },
 {
  "sentence": "You shall be ___ innocent unless you are proven guilty.",
  "answers": ["presumed"],
  "translation": "You shall be presumed innocent unless you are proven guilty.",
  "jpTranslation": "有罪と証明されない限り、あなたは無罪と見なされます。",
  "blanksTranslation": ["〜と推定する"]
 },
 {
  "sentence": "___ bags cannot be used as carry-on luggage.",
  "answers": ["Bulky"],
  "translation": "Bulky bags cannot be used as carry-on luggage.",
  "jpTranslation": "かさばるバッグは機内持ち込み手荷物としては使用できない。",
  "blanksTranslation": ["かさばった"]
 },
 {
  "sentence": "The candidate ___ the election following the court's decision.",
  "answers": ["conceded"],
  "translation": "The candidate conceded the election following the court's decision.",
  "jpTranslation": "その候補者は、裁判所の決定に従って選挙の敗北を認めた。",
  "blanksTranslation": ["(敗北)を認める"]
 },
 {
  "sentence": "She ___ her shoulders when her teacher asked her the question.",
  "answers": ["shrugged"],
  "translation": "She shrugged her shoulders when her teacher asked her the question.",
  "jpTranslation": "先生に質問されて、彼女は肩をすくめた。",
  "blanksTranslation": ["(肩)をすくめる"]
 },
 {
  "sentence": "Investigators worked to ___ the crime scene.",
  "answers": ["reconstruct"],
  "translation": "Investigators worked to reconstruct the crime scene.",
  "jpTranslation": "捜査官たちは犯行現場を再現しようと取り組んだ。",
  "blanksTranslation": ["〜を再現する"]
 },
 {
  "sentence": "There were many large ___ surrounding the demolition site.",
  "answers": ["barricades"],
  "translation": "There were many large barricades surrounding the demolition site.",
  "jpTranslation": "解体現場を取り囲む大きなバリケードがたくさんあった。",
  "blanksTranslation": ["バリケード"]
 },
 {
  "sentence": "The couple went to an ___ dinner with the CEO.",
  "answers": ["extravagant"],
  "translation": "The couple went to an extravagant dinner with the CEO.",
  "jpTranslation": "その夫婦はCEOと豪華なディナーに行った。",
  "blanksTranslation": ["浪費する"]
 },
 {
  "sentence": "The business partners worked hard to ___ their differences.",
  "answers": ["reconcile"],
  "translation": "The business partners worked hard to reconcile their differences.",
  "jpTranslation": "ビジネスパートナーたちは相違点を調整するために努力した。",
  "blanksTranslation": ["〜を調和させる"]
 },
 {
  "sentence": "Monthly members are ___ from paying the admission fee.",
  "answers": ["exempt"],
  "translation": "Monthly members are exempt from paying the admission fee.",
  "jpTranslation": "月会員は入場料を免除されます。",
  "blanksTranslation": ["免除された"]
 },
 {
  "sentence": "She takes a ___ around the park every morning.",
  "answers": ["stroll"],
  "translation": "She takes a stroll around the park every morning.",
  "jpTranslation": "彼女は毎朝公園をのんびり散歩する。",
  "blanksTranslation": ["散策"]
 },
 {
  "sentence": "They are ___ for being inflexible in their opinions.",
  "answers": ["notorious"],
  "translation": "They are notorious for being inflexible in their opinions.",
  "jpTranslation": "彼らは自分の意見を曲げないことで悪名高い。",
  "blanksTranslation": ["悪名高い"]
 },
 {
  "sentence": "We could ___ the quality of sound produced by our headphones.",
  "answers": ["enhance"],
  "translation": "We could enhance the quality of sound produced by our headphones.",
  "jpTranslation": "私たちは、ヘッドフォンから出る音の質を高めることができた。",
  "blanksTranslation": ["〜を高める"]
 },
 {
  "sentence": "This mark ___ that the food was grown organically.",
  "answers": ["signifies"],
  "translation": "This mark signifies that the food was grown organically.",
  "jpTranslation": "このマークは食品が有機農法で生産されたことを示している。",
  "blanksTranslation": ["〜を示す"]
 }
   ];

    let current = 0, score = 0;
    let userAnswers = [], incorrectQuestions = [], retryMode = false, wrongAnswers = [];

    const qEl = document.getElementById("question");
    const inputEl = document.getElementById("inputs");
    const feedbackEl = document.getElementById("feedback");
    const translationEl = document.getElementById("translation");
    const progressEl = document.getElementById("progress");
    const progressBar = document.getElementById("progressBar");
    const scoreBoard = document.getElementById("scoreBoard");
    const pdfBtn = document.getElementById("pdfBtn");
    const wrongPdfBtn = document.getElementById("wrongPdfBtn");
    const retryBtn = document.getElementById("retryBtn");
    const showAllBtn = document.getElementById("showAllBtn");
    const nameLabel = document.getElementById("nameLabel");

    // === ランダムシャッフル関数 ===
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function loadQuestion() {
      const q = questions[current];
      qEl.textContent = `Q${current + 1} / ${questions.length}: ${q.sentence}`;
      inputEl.innerHTML = "";
      feedbackEl.textContent = "";
      translationEl.textContent = "";

      q.answers.forEach((_, i) => {
        const inp = document.createElement("input");
        inp.type = "text";
        inp.className = "input-field";
        inp.id = "ans" + i;
        inputEl.appendChild(inp);
      });

      const inputs = document.querySelectorAll(".input-field");
      inputs.forEach((inp, idx) => {
        inp.addEventListener("keypress", e => {
          if (e.key === "Enter") {
            e.preventDefault();
            if (idx < inputs.length - 1) {
              inputs[idx + 1].focus();
            } else {
              checkAnswer();
            }
          }
        });
      });

      document.getElementById("submitBtn").classList.remove("hidden");
      document.getElementById("nextBtn").classList.add("hidden");

      progressEl.style.width = `${(current / questions.length) * 100}%`;
    }

    function checkAnswer() {
      const q = questions[current];
      let correct = true, answersGiven = [];

      q.answers.forEach((ans, i) => {
        const userAns = document.getElementById("ans" + i).value.trim();
        answersGiven.push(userAns);
        if (userAns.toLowerCase() !== ans.toLowerCase()) correct = false;
      });

      userAnswers.push({ question: q.sentence, user: answersGiven, correct: q.answers });

      if (correct) {
        feedbackEl.textContent = "✅ Correct!";
        score++;
      } else {
        feedbackEl.textContent = "❌ Incorrect!";
        incorrectQuestions.push(q);
        wrongAnswers.push(q);
      }

      let highlighted = q.translation;
      q.answers.forEach(ans => {
        const regex = new RegExp(`\\b${ans}\\b`, "gi");
        highlighted = highlighted.replace(regex, `<span style="color:red;">${ans}</span>`);
      });

      translationEl.innerHTML = `
        <p><b>英文:</b> ${highlighted} <button class="circle-button" onclick="speak('${q.translation}')">🔊</button></p>
        <p><b>答え:</b> ${q.answers.join(", ")} ${q.answers.map(ans => `<button class="circle-button" onclick="speak('${ans}')">🔊</button>`).join(" ")}</p>
        <p><b>和訳:</b> ${q.jpTranslation}</p>
        <p><b>答えの和訳:</b> ${q.blanksTranslation.join(", ")}</p>
      `;

      document.getElementById("submitBtn").classList.add("hidden");
      document.getElementById("nextBtn").classList.remove("hidden");
    }

    function nextQuestion() {
      current++;
      if (current < questions.length) {
        loadQuestion();
      } else {
        progressEl.style.width = "100%";
        scoreBoard.textContent = `Your score: ${score} / ${questions.length}`;
        progressBar.classList.add("hidden");
        showAllBtn.classList.remove("hidden");
        nameLabel.classList.add("hidden");
      }
    }

    function speak(text) {
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "en-US";
      u.voice = speechSynthesis.getVoices().find(v => v.lang === "en-US" && v.name.includes("Female")) || null;
      speechSynthesis.speak(u);
    }

    function showAllResults() {
      qEl.textContent = "All Results";
      inputEl.innerHTML = "";
      feedbackEl.textContent = "";
      translationEl.innerHTML = "";

      const username = document.getElementById("username").value.trim();
      translationEl.innerHTML = `<p><b>Name:</b> ${username || "(No name)"}</p>
                                 <p><b>Score:</b> ${score} / ${questions.length}</p>`;

      userAnswers.forEach((entry, idx) => {
        const div = document.createElement("div");
        div.style.textAlign = "left";
        div.style.margin = "10px";
        div.innerHTML = `
          <p><b>Q${idx + 1}:</b> ${entry.question}</p>
          <p>Your Answer: ${entry.user.join(", ")} | Correct: ${entry.correct.join(", ")}</p>
        `;
        translationEl.appendChild(div);
      });

      pdfBtn.classList.remove("hidden");
      wrongPdfBtn.classList.remove("hidden");
      if (incorrectQuestions.length > 0 && !retryMode) retryBtn.classList.remove("hidden");

      showAllBtn.classList.add("hidden");
      document.getElementById("nextBtn").classList.add("hidden");
    }

    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const username = document.getElementById("username").value.trim();

      doc.setFontSize(14);
      doc.text("Quiz Results", 10, 10);
      if (username) doc.text(`Name: ${username}`, 150, 10);
      doc.text(`Score: ${score} / ${questions.length}`, 10, 20);

      let y = 30;
      userAnswers.forEach((entry, idx) => {
        const linesQ = doc.splitTextToSize(`${idx + 1}. Question: ${entry.question}`, 180);
        doc.text(linesQ, 10, y); y += linesQ.length * 8;

        const linesU = doc.splitTextToSize(`Your Answer: ${entry.user.join(", ")}`, 180);
        doc.text(linesU, 10, y); y += linesU.length * 8;

        const linesC = doc.splitTextToSize(`Correct Answer: ${entry.correct.join(", ")}`, 180);
        doc.text(linesC, 10, y); y += linesC.length * 8 + 5;

        if (y > 270) { doc.addPage(); y = 20; }
      });

      doc.save("quiz_results.pdf");
    }

    function downloadWrongPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFontSize(14);
      doc.text("Wrong Vocabulary Results", 10, 10);

      let y = 20;
      wrongAnswers.forEach((q, idx) => {
        const linesQ = doc.splitTextToSize(`${idx + 1}. ${q.sentence}`, 180);
        doc.text(linesQ, 10, y); y += linesQ.length * 8;

        const linesA = doc.splitTextToSize(`Answer: ${q.answers.join(", ")}`, 180);
        doc.text(linesA, 10, y); y += linesA.length * 8 + 5;

        if (y > 270) { doc.addPage(); y = 20; }
      });

      doc.save("Wrong-vocab.pdf");
    }

    function retryIncorrect() {
      if (incorrectQuestions.length === 0) return;
      questions.splice(0, questions.length, ...incorrectQuestions);
      current = 0; score = 0;
      userAnswers = []; incorrectQuestions = []; retryMode = true;
      progressBar.classList.remove("hidden");
      showAllBtn.classList.add("hidden");
      retryBtn.classList.add("hidden");
      pdfBtn.classList.add("hidden");
      wrongPdfBtn.classList.add("hidden");
      nameLabel.classList.remove("hidden");
      loadQuestion();
    }

    pdfBtn.onclick = downloadPDF;
    wrongPdfBtn.onclick = downloadWrongPDF;
    document.getElementById("submitBtn").onclick = checkAnswer;
    document.getElementById("nextBtn").onclick = nextQuestion;
    showAllBtn.onclick = showAllResults;
    retryBtn.onclick = retryIncorrect;

    // === 最初に問題をシャッフルして開始 ===
    shuffle(questions);
    loadQuestion();
  </script>
</body>
</html>
